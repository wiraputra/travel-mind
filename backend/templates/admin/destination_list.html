{% extends "admin/admin_base.html" %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1>Daftar Destinasi</h1>
  <button
    type="button"
    class="btn btn-success"
    data-bs-toggle="modal"
    data-bs-target="#importModal"
  >
    Impor dari File
  </button>
  <a href="{{ url_for('.add_destination') }}" class="btn btn-primary"
    >Buat Destinasi Baru</a
  >
</div>

<form method="get" class="mb-3">
  <div class="input-group">
    <input
      type="text"
      name="q"
      class="form-control"
      placeholder="Cari berdasarkan nama destinasi..."
      value="{{ search_term or '' }}"
    />
    <button class="btn btn-outline-secondary" type="submit">Cari</button>
  </div>
</form>

<div class="table-responsive">
  <table class="table table-striped table-bordered table-hover">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Nama</th>
        <th>Kota</th>
        <th>Negara</th>
        <th>Kategori</th>
        <th>Rating</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody>
      {% for dest in destinations.items %}
      <tr>
        <td>{{ dest.destination_id }}</td>
        <td>{{ dest.name }}</td>
        <td>{{ dest.city or '-' }}</td>
        <td>{{ dest.country or '-' }}</td>
        <td>{{ dest.category or '-' }}</td>
        <td>{{ dest.avg_rating or 'N/A' }}</td>
        <td>
          <a
            href="{{ url_for('.edit_destination', destination_id=dest.destination_id) }}"
            class="btn btn-sm btn-warning"
            >Edit</a
          >
          <form
            action="{{ url_for('.delete_destination', destination_id=dest.destination_id) }}"
            method="post"
            class="d-inline"
            onsubmit="return confirm('Anda yakin ingin menghapus destinasi ini?');"
          >
            <button type="submit" class="btn btn-sm btn-danger">Hapus</button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="7" class="text-center">Tidak ada destinasi ditemukan.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
{% if destinations.pages > 1 %}
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <li class="page-item {% if not destinations.has_prev %}disabled{% endif %}">
      <a
        class="page-link"
        href="{{ url_for('.destinations_list', page=destinations.prev_num, q=search_term) }}"
        >Sebelumnya</a
      >
    </li>
    {% for page_num in destinations.iter_pages(left_edge=1, right_edge=1,
    left_current=1, right_current=2) %} {% if page_num %}
    <li
      class="page-item {% if destinations.page == page_num %}active{% endif %}"
    >
      <a
        class="page-link"
        href="{{ url_for('.destinations_list', page=page_num, q=search_term) }}"
        >{{ page_num }}</a
      >
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">â€¦</span></li>
    {% endif %} {% endfor %}
    <li class="page-item {% if not destinations.has_next %}disabled{% endif %}">
      <a
        class="page-link"
        href="{{ url_for('.destinations_list', page=destinations.next_num, q=search_term) }}"
        >Berikutnya</a
      >
    </li>
  </ul>
</nav>
{% endif %}

<!-- Modal untuk Upload File -->
<div
  class="modal fade"
  id="importModal"
  tabindex="-1"
  aria-labelledby="importModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <form
        action="{{ url_for('.import_destinations') }}"
        method="post"
        enctype="multipart/form-data"
      >
        <div class="modal-header">
          <h5 class="modal-title" id="importModalLabel">
            Impor Destinasi dari File
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <p>
            Unggah file CSV atau TXT. Pastikan file memiliki header dan kolom
            berikut (urutan tidak masalah, nama header harus sama persis):
          </p>
          <small>
            <ul class="list-group list-group-flush">
              <li class="list-group-item py-1 px-0">
                <b>Wajib:</b> <code>name</code>, <code>latitude</code>,
                <code>longitude</code>
              </li>
              <li class="list-group-item py-1 px-0">
                <b>Opsional:</b> <code>description</code>, <code>address</code>,
                <code>city</code>, <code>country</code>, <code>category</code>,
                <code>tags</code>, <code>image_url</code>,
                <code>avg_rating</code>, <code>opening_hours</code>,
                <code>typical_visit_duration_minutes</code>
              </li>
            </ul>
          </small>
          <hr />
          <div class="mb-3">
            <label for="file" class="form-label"
              >Pilih file (.csv, .txt):</label
            >
            <input
              class="form-control"
              type="file"
              id="file"
              name="file"
              accept=".csv,.txt"
              required
            />
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Batal
          </button>
          <button type="submit" class="btn btn-primary">
            Unggah dan Proses
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
